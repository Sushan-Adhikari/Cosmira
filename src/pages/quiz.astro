---
import Layout from "../layouts/layout.astro";

// src/components/SpaceQuiz.astro
---

<Layout>
  <div
    class="w-full md:max-w-[80%] mt-10 mx-auto  text-white shadow-md font- rounded-lg overflow-hidden"
    id="quiz-container"
  >
    <div class="p-6">
      <h2 class="text-2xl font-bold text-center mb-6">Space Quiz</h2>

      <!-- Timer Display -->
      <div class="text-center mb-4 ">
        <span id="timer" class="text-gray-500 font-bold text-xl"></span>
      </div>

      <div id="question-container" class="mb-6 ">
        <!-- Questions will be dynamically inserted here -->
      </div>
      <div class="flex justify-center">
        <button
          id="next-btn"
          class="bg-gray-900 hover:bg-gray-800 cursor-pointer transition-all text-white font-bold py-3 px-4 rounded-full"
        >
          Next Question
        </button>
      </div>
    </div>
  </div>
</Layout>

<script>
  const quizData = [
    {
      question: "What is the largest planet in our solar system?",
      options: ["Mars", "Jupiter", "Saturn", "Neptune"],
      correctAnswer: "Jupiter",
    },
    {
      question: "Which planet is known as the Red Planet?",
      options: ["Venus", "Mars", "Mercury", "Uranus"],
      correctAnswer: "Mars",
    },
    {
      question: "What is the name of Earth's natural satellite?",
      options: ["Moon", "Titan", "Europa", "Phobos"],
      correctAnswer: "Moon",
    },
    {
      question: "Which is the hottest planet in our solar system?",
      options: ["Mercury", "Venus", "Mars", "Jupiter"],
      correctAnswer: "Venus",
    },
    {
      question: "What is the Great Red Spot on Jupiter?",
      options: ["A volcano", "A storm", "A crater", "An ocean"],
      correctAnswer: "A storm",
    },
  ];

  let currentQuestion = 0;
  let score = 0;
  let timeLeft = 120; // 2 minutes for the entire quiz (in seconds)

  const questionContainer = document.getElementById("question-container");
  const nextButton = document.getElementById("next-btn");
  const timerDisplay = document.getElementById("timer");

  function displayQuestion() {
    // font-family: "Roboto", sans-serif;
    const question = quizData[currentQuestion];
    let html = `
        <h3 class="text-2xl font-semibold mb-4">${question.question}</h3>
        <div class="space-y-2">
      `;

    question.options.forEach((option, index) => {
      html += `
          <div class="flex items-center hover:bg-gray-900 hover:cursor-pointer w-1/3 p-2 rounded-full ">
            <input type="radio" id="option${index}" name="answer" value="${option}" class="mr-2">
            <label for="option${index}">${option}</label>
          </div>
        `;
    });

    html += "</div>";
    questionContainer.innerHTML = html;
  }

  function checkAnswer() {
    const selectedAnswer = document.querySelector(
      'input[name="answer"]:checked'
    );
    if (selectedAnswer) {
      if (selectedAnswer.value === quizData[currentQuestion].correctAnswer) {
        score++;
      }
      currentQuestion++;
      if (currentQuestion < quizData.length) {
        displayQuestion();
      } else {
        showResults();
      }
    }
  }

  function showResults() {
    const percentage = (score / quizData.length) * 100;
    let recommendation;

    if (percentage >= 80) {
      recommendation = {
        title: "Excellent work, space explorer!",
        description:
          "Your knowledge of space is stellar. For more advanced topics, check out NASA's official website or consider reading 'An Introduction to Modern Astrophysics' by Carroll and Ostlie.",
        link: "https://www.nasa.gov/",
      };
    } else if (percentage >= 60) {
      recommendation = {
        title: "Great job, you're on your way to becoming a space expert!",
        description:
          "To boost your knowledge, we recommend watching 'Cosmos: A Spacetime Odyssey' hosted by Neil deGrasse Tyson or reading 'A Brief History of Time' by Stephen Hawking.",
        link: "https://www.nationalgeographic.com/tv/shows/cosmos-a-spacetime-odyssey",
      };
    } else {
      recommendation = {
        title: "Your space journey is just beginning!",
        description:
          "Don't worry, space is a vast topic! Start with 'Astronomy: A Self-Teaching Guide' by Dinah L. Moch√© or explore the interactive website 'Solar System Scope' to learn more about our cosmic neighborhood.",
        link: "https://www.solarsystemscope.com/",
      };
    }

    questionContainer.innerHTML = `
        <h3 class="text-xl font-bold mb-4">Quiz Completed!</h3>
        <p class="text-lg mb-4">Your score: ${score} out of ${quizData.length}</p>
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-4" role="alert">
          <p class="font-bold">${recommendation.title}</p>
          <p>${recommendation.description}</p>
          <a href="${recommendation.link}" target="_blank" rel="noopener noreferrer" class="block mt-2 text-blue-500 hover:underline">
            Learn More
          </a>
        </div>
      `;
    nextButton.textContent = "Restart Quiz";
    nextButton.removeEventListener("click", checkAnswer);
    nextButton.addEventListener("click", restartQuiz);
  }

  function restartQuiz() {
    currentQuestion = 0;
    score = 0;
    timeLeft = 120; // Reset timer
    displayQuestion();
    nextButton.textContent = "Next Question";
    nextButton.removeEventListener("click", restartQuiz);
    nextButton.addEventListener("click", checkAnswer);
  }

  function startTimer() {
    const timerInterval = setInterval(() => {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerDisplay.textContent = `Time Left: ${minutes}:${seconds < 10 ? "0" + seconds : seconds}`;

      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        showResults(); // Time's up, show results
      }
      timeLeft--;
    }, 1000);
  }

  displayQuestion();
  startTimer(); // Start the countdown timer when the quiz loads
  nextButton.addEventListener("click", checkAnswer);
</script>
